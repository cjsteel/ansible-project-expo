<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Christopher Steel"><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.1.7"><title>Initial Controller Configuration - Ansible Expo</title><link rel=stylesheet href=../../assets/stylesheets/main.19753c6b.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.196e0c26.min.css><meta name=theme-color content=#4051b5><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style></head> <body dir=ltr data-md-color-scheme data-md-color-primary=indigo data-md-color-accent=deep-purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#initial-controller-configuration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../.. title="Ansible Expo" class="md-header-nav__button md-logo" aria-label="Ansible Expo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Ansible Expo </span> <span class="md-header-nav__topic md-ellipsis"> Initial Controller Configuration </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class="md-tabs__link md-tabs__link--active"> Home </a> </li> <li class=md-tabs__item> <a href=../../development/ class=md-tabs__link> Development </a> </li> <li class=md-tabs__item> <a href=../../venv/installing-ansible-into-a-virtual-python-3-environment.md class=md-tabs__link> Controller </a> </li> <li class=md-tabs__item> <a href=../../maintenance-command-examples.md class=md-tabs__link> Usage </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Ansible Expo" class="md-nav__button md-logo" aria-label="Ansible Expo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Ansible Expo </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Development <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Development data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../development/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../development/configuring-an-expo-development-system/ class=md-nav__link> configuration </a> </li> <li class=md-nav__item> <a href=../../development/ansible-project-setup/ class=md-nav__link> ansible </a> </li> <li class=md-nav__item> <a href=../../development/project-development/ class=md-nav__link> project development </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Controller <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Controller data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"></span> Controller </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../venv/installing-ansible-into-a-virtual-python-3-environment.md class=md-nav__link> venv </a> </li> <li class=md-nav__item> <a href=../../sshkeys class=md-nav__link> sshkeys </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Usage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Usage data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> Usage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../maintenance-command-examples.md class=md-nav__link> Maintenance Commnads </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> Adding New Systems <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Adding New Systems" data-md-level=2> <label class=md-nav__title for=nav-4-2> <span class="md-nav__icon md-icon"></span> Adding New Systems </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-1 type=checkbox id=nav-4-2-1> <label class=md-nav__link for=nav-4-2-1> System preparations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="System preparations" data-md-level=3> <label class=md-nav__title for=nav-4-2-1> <span class="md-nav__icon md-icon"></span> System preparations </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-1-1 type=checkbox id=nav-4-2-1-1> <label class=md-nav__link for=nav-4-2-1-1> BIOS/(U)EFI Settings <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="BIOS/(U)EFI Settings" data-md-level=4> <label class=md-nav__title for=nav-4-2-1-1> <span class="md-nav__icon md-icon"></span> BIOS/(U)EFI Settings </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../bios/enabling-wol.md class=md-nav__link> Wake-on-LAN (Wol) </a> </li> <li class=md-nav__item> <a href=../../bios/enabling-pxe.md class=md-nav__link> Network booting </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-1-2 type=checkbox id=nav-4-2-1-2> <label class=md-nav__link for=nav-4-2-1-2> Hardware <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Hardware data-md-level=4> <label class=md-nav__title for=nav-4-2-1-2> <span class="md-nav__icon md-icon"></span> Hardware </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mdadm/index.md class=md-nav__link> Mirrored boot </a> </li> <li class=md-nav__item> <a href=../../chassis/index.md class=md-nav__link> Drive locations </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-1-3 type=checkbox id=nav-4-2-1-3> <label class=md-nav__link for=nav-4-2-1-3> DNS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=DNS data-md-level=4> <label class=md-nav__title for=nav-4-2-1-3> <span class="md-nav__icon md-icon"></span> DNS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dns/index.md class=md-nav__link> DNS </a> </li> <li class=md-nav__item> <a href=../../etc_hosts/index.md class=md-nav__link> /etc/hosts file </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-2 type=checkbox id=nav-4-2-2> <label class=md-nav__link for=nav-4-2-2> Connectivity <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Connectivity data-md-level=3> <label class=md-nav__title for=nav-4-2-2> <span class="md-nav__icon md-icon"></span> Connectivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ssh/testing-connectivity.md class=md-nav__link> Connectivity test </a> </li> <li class=md-nav__item> <a href=../../ssh/sshagent.md class=md-nav__link> ssh agent </a> </li> <li class=md-nav__item> <a href=../../ssh/sshadd.md class=md-nav__link> ssh-add </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2-3 type=checkbox id=nav-4-2-3> <label class=md-nav__link for=nav-4-2-3> inventory/production/hosts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=inventory/production/hosts data-md-level=3> <label class=md-nav__title for=nav-4-2-3> <span class="md-nav__icon md-icon"></span> inventory/production/hosts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../inventory/workstation-example.md class=md-nav__link> Research Workstation example </a> </li> <li class=md-nav__item> <a href=../../inventory/server-example.yml class=md-nav__link> Storage Server example </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> <nav class=md-nav aria-label=Requirements> <ul class=md-nav__list> <li class=md-nav__item> <a href=#python-3 class=md-nav__link> Python 3 </a> </li> <li class=md-nav__item> <a href=#pip3 class=md-nav__link> pip3 </a> </li> <li class=md-nav__item> <a href=#venv class=md-nav__link> venv </a> <nav class=md-nav aria-label=venv> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ansible class=md-nav__link> Ansible </a> <nav class=md-nav aria-label=Ansible> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ansible-galaxy-hosted-roles class=md-nav__link> Ansible Galaxy Hosted Roles </a> </li> <li class=md-nav__item> <a href=#ansible-git-hosted-public-and-private-roles class=md-nav__link> Ansible git hosted public and private roles </a> </li> <li class=md-nav__item> <a href=#installing-production-roles class=md-nav__link> Installing production roles </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=initial-controller-configuration>Initial Controller Configuration<a class=headerlink href=#initial-controller-configuration title="Permanent link">&para;</a></h1> <h3 id=requirements>Requirements<a class=headerlink href=#requirements title="Permanent link">&para;</a></h3> <h4 id=python-3>Python 3<a class=headerlink href=#python-3 title="Permanent link">&para;</a></h4> <h4 id=pip3>pip3<a class=headerlink href=#pip3 title="Permanent link">&para;</a></h4> <h4 id=venv>venv<a class=headerlink href=#venv title="Permanent link">&para;</a></h4> <h5 id=ansible>Ansible<a class=headerlink href=#ansible title="Permanent link">&para;</a></h5> <h6 id=ansible-galaxy-hosted-roles>Ansible Galaxy Hosted Roles<a class=headerlink href=#ansible-galaxy-hosted-roles title="Permanent link">&para;</a></h6> <p>These are finished and tested production roles that support the <code>ansible-galaxy install</code> command</p> <h6 id=ansible-git-hosted-public-and-private-roles>Ansible git hosted public and private roles<a class=headerlink href=#ansible-git-hosted-public-and-private-roles title="Permanent link">&para;</a></h6> <p>These roles are github based roles which contain new features and/or customizations of roles found on Ansible Galaxy or roles that are not yet hosted by Ansible Galaxy</p> <p>These should only include tested and production ready roles These roles might also include:</p> <ul> <li>New updates and features.</li> <li>That the original developer is not interested in puling.</li> <li>That have not yet or may never be hosted on Ansible Galaxy</li> <li>Transient Roles</li> <li>Once time hot fixes</li> <li>Patches</li> </ul> <h6 id=installing-production-roles>Installing production roles<a class=headerlink href=#installing-production-roles title="Permanent link">&para;</a></h6> <p>We make use of an Ansible Galaxy supported <code>roles/requirements.yml</code> file which allows for the loading of both Ansible Galaxy and git repository hosted roles.</p> <h1 id=orchestrating-systems>Orchestrating Systems<a class=headerlink href=#orchestrating-systems title="Permanent link">&para;</a></h1> <h2 id=base-configuration>Base configuration<a class=headerlink href=#base-configuration title="Permanent link">&para;</a></h2> <p>All systems on our imaginary LAN must have a (minimal) base configuration before the may become LAN members.</p> <p>In this example we will apply the (minimal) base configuration to a new system called <strong>workstation-003</strong></p> <h3 id=requirements_1>Requirements<a class=headerlink href=#requirements_1 title="Permanent link">&para;</a></h3> <ul> <li>resolvable host name</li> <li>must be included in the controllers inventory</li> <li>must have an administrative user</li> <li>must be reachable via ssh</li> <li>known_hosts</li> </ul> <h2 id=resolvable-host-name>Resolvable Host Name<a class=headerlink href=#resolvable-host-name title="Permanent link">&para;</a></h2> <h3 id=dns>DNS<a class=headerlink href=#dns title="Permanent link">&para;</a></h3> <div class=codehilite><pre><span></span><code>nslookup workstation-003
</code></pre></div> <h3 id=etchosts-file>/etc/hosts file<a class=headerlink href=#etchosts-file title="Permanent link">&para;</a></h3> <p>In some cases, for example when developing or for systems that must continue running when a DNS is not available you may need to add new hosts to the controllers <code>/etc/hosts</code>. </p> <p>In this example our controller is applying the base configuration to three new system on a private network:</p> <div class=codehilite><pre><span></span><code>127.0.0.1   localhost
127.0.1.1   controller-001
192.168.1.124   workstation-001
192.168.1.125   workstation-002
192.168.1.126   workstation-003

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</code></pre></div> <p>Note: Once the hostname and ip address have been added to the controllers <code>/etc/hosts</code> we are able to reach it using the hostname <em>even though the hostname on the target system, workstation-003 in this case, may not be correct at the moment</em>.</p> <h2 id=connectivity-test>Connectivity test<a class=headerlink href=#connectivity-test title="Permanent link">&para;</a></h2> <p>We manually connect to the new host via ssh for our controller in order to ensure that everything is working as it should.</p> <p>This will also allow us to add our controller to the known_hosts file on the new system, or in some development situations, will give us an opportunity to remove any stale known_hosts entries.</p> <p>In this example our remote administrative user is the user <em>julie</em></p> <div class=codehilite><pre><span></span><code>ssh julie@workstation-003
</code></pre></div> <p>If this example I am connecting from a controller running Ubuntu 20.04 and I get the following message as it is the first time I am connecting to a host named <strong>workstation-003</strong>.</p> <div class=codehilite><pre><span></span><code>The authenticity of host <span class=s1>&#39;workstation-003 (192.168.1.100)&#39;</span> can<span class=err>&#39;</span>t be established.
ECDSA key fingerprint is SHA256:vXCJtTry4lMOc3cwMQ50vdFRG9JyR9jovZWs4XYY+JY.
Are you sure you want to <span class=k>continue</span> connecting <span class=o>(</span>yes/no/<span class=o>[</span>fingerprint<span class=o>])</span>? yes
</code></pre></div> <p>As this is a private network running DHCP, I have connected to other hosts using the IP 192.168.0.100 previously and my output looks like this:</p> <div class=codehilite><pre><span></span><code>Warning: Permanently added <span class=s1>&#39;workstation-003&#39;</span> <span class=o>(</span>ECDSA<span class=o>)</span> to the list of known hosts.
Warning: the ECDSA host key <span class=k>for</span> <span class=s1>&#39;workstation-003&#39;</span> differs from the key <span class=k>for</span> the IP address <span class=s1>&#39;192.168.1.100&#39;</span>
Offending key <span class=k>for</span> IP in /home/csteel/.ssh/known_hosts:5
Are you sure you want to <span class=k>continue</span> connecting <span class=o>(</span>yes/no<span class=o>)</span>? no
</code></pre></div> <p>I remove the 5th line from my controllers (development system) <code>~/.ssh/known_hosts</code> file and try and connect again:</p> <div class=codehilite><pre><span></span><code>ssh julie@workstation-003
</code></pre></div> <p>This time I am prompted for the admin users password:</p> <div class=codehilite><pre><span></span><code>Warning: Permanently added the ECDSA host key <span class=k>for</span> IP address <span class=s1>&#39;192.168.1.100&#39;</span> to the list of known hosts.
julie@workstation-003<span class=err>&#39;</span>s password: 
</code></pre></div> <p>Once I type in the correct password, "mypassword", with no quoted in this example, I am able to connect:</p> <div class=codehilite><pre><span></span><code>julie@workstation-003<span class=err>&#39;</span>s password: 
Welcome to Ubuntu <span class=m>20</span>.04 LTS <span class=o>(</span>GNU/Linux <span class=m>5</span>.4.0-29-generic x86_64<span class=o>)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

Last login: Wed May  <span class=m>6</span> <span class=m>19</span>:17:44 <span class=m>2020</span> from <span class=m>192</span>.168.1.101
To run a <span class=nb>command</span> as administrator <span class=o>(</span>user <span class=s2>&quot;root&quot;</span><span class=o>)</span>, use <span class=s2>&quot;sudo &lt;command&gt;&quot;</span>.
See <span class=s2>&quot;man sudo_root&quot;</span> <span class=k>for</span> details.

julie@ubuntu:~$ 
</code></pre></div> <p>SSH is working correctly so I exit and move on to the next step</p> <div class=codehilite><pre><span></span><code>julie@ubuntu:~$ <span class=nb>exit</span>
</code></pre></div> <h3 id=ssh-agent>ssh agent<a class=headerlink href=#ssh-agent title="Permanent link">&para;</a></h3> <p>The OpenSSH authentication agent will be used to hold private keys used for public key authentication.</p> <p>When the ssh-agent is started, it prints the shell commands required to set its environment variables.</p> <p>SSH looks at these environment variables and uses them to establish a connection to the agent.</p> <p>These environment variables are evaluated in the calling shell, bash or csh for example.</p> <p>Here we evaluate the environment variables from the terminal (probably the bash shell in many cases) and if ssh-agent is installed and running we should get ssh-agents PID (Process ID) as output.</p> <p>Evaluation command:</p> <div class=codehilite><pre><span></span><code><span class=nb>eval</span> <span class=sb>`</span>/usr/bin/ssh-agent -s<span class=sb>`</span>
</code></pre></div> <p>Output example:</p> <div class=codehilite><pre><span></span><code>Agent pid <span class=m>376452</span>
</code></pre></div> <h3 id=ssh-add>ssh-add<a class=headerlink href=#ssh-add title="Permanent link">&para;</a></h3> <p>ssh-agent initially does not have any private keys.</p> <p>ssh-add is used to add one or more private key identities to the OpenSSH authentication agent (ssh-agent). </p> <p>Private keys can be added using <strong>ssh-add</strong> or by ssh when AddKeysToAgent is set in ssh_config.</p> <p>Multiple keys (identities) may be stored in ssh-agent concurrently and ssh will automatically use them if present.</p> <p>In addition to adding keys, ssh-add can also be used to remove keys from ssh-agent and to query the keys that are currently held by the agent.</p> <p>In the previous section we confirmed that the ssh-agent was installed and running. Now we will add a private key to the ssh-agent</p> <p>If all is as it should be, running the following command should prompt you for the keys pass phrase and will remember it on your local system (the controller) and it will be automatically provided when ssh requests it:</p> <div class=codehilite><pre><span></span><code>/usr/bin/ssh-add
Enter passphrase <span class=k>for</span> /home/csteel/.ssh/id_rsa: my top secret pass phrase is this
</code></pre></div> <p>If you provided the correct pass phrase you will get the following output and you are ready to move on to the next step:</p> <div class=codehilite><pre><span></span><code>Identity added: /home/csteel/.ssh/id_rsa <span class=o>(</span>/home/csteel/.ssh/id_rsa<span class=o>)</span>
</code></pre></div> <h2 id=close-remote-connections>Close remote connections<a class=headerlink href=#close-remote-connections title="Permanent link">&para;</a></h2> <p>If you logged into one or more <strong>new</strong> target hosts as a temporary administrative user, for example to open a port or confirm connectivity, you will want to <strong>logout and close any other terminal sessions with all target hosts</strong> before applying the base configuration. <strong>Otherwise, you application of the base configuration will fail as the temporary administrative user will still have running processes.</strong> </p> <h3 id=inventoryproductionhosts>inventory/production/hosts<a class=headerlink href=#inventoryproductionhosts title="Permanent link">&para;</a></h3> <p>In this example we see that <strong>workstation-003</strong> has been added to the <strong>[workstations]</strong> section of our <em>ini</em> style hosts file:</p> <div class=codehilite><pre><span></span><code><span class=k>[controllers]</span>
<span class=na>controller-001</span>
<span class=na>controller-002</span>

<span class=k>[servers]</span>
<span class=na>server-001</span>
<span class=na>server-002</span>

<span class=k>[workstations]</span>
<span class=na>workstation-001</span>
<span class=na>workstation-002</span>
<span class=na>workstation-003</span>

<span class=na>[base:children]         </span>
<span class=na>controllers</span>
<span class=na>servers</span>
<span class=na>workstations</span>
</code></pre></div> <p>In the <strong>[base:children]</strong> section we see that <strong>controllers</strong>, <strong>servers</strong> and <strong>workstations</strong> are all <em>children</em> of the <strong>base</strong> configuration section. In other words systems in the <strong>controllers</strong>, <strong>servers</strong> and <strong>workstations</strong> sections can all have the base configuration applied to them.</p> <h2 id=ansiblecfg-file><code>ansible.cfg</code> file<a class=headerlink href=#ansiblecfg-file title="Permanent link">&para;</a></h2> <p>I want to make sure that <code>ansible.cfg</code> is pointing to the correct inventory file so I cat it:</p> <div class=codehilite><pre><span></span><code>cat ansible.cfg <span class=p>|</span> grep inventory
</code></pre></div> <p>Output example:</p> <div class=codehilite><pre><span></span><code>log_path = inventory/testing/log/ansible.log
inventory = inventory/testing
</code></pre></div> <p>ansible.cfg is pointing to the testing inventory so I can manually edit it or run the included <code>./config.sh</code> script like this:</p> <div class=codehilite><pre><span></span><code>./config.sh production
</code></pre></div> <p>and confirm in the output that we are now using the production inventory:</p> <div class=codehilite><pre><span></span><code>production
Copying production to ansible.cfg
<span class=nv>log_path</span> <span class=o>=</span> inventory/production/log/ansible.log
<span class=nv>inventory</span> <span class=o>=</span> inventory/production
</code></pre></div> <h2 id=applying-the-base-configuration>Applying the base configuration<a class=headerlink href=#applying-the-base-configuration title="Permanent link">&para;</a></h2> <h3 id=inventoryproductiongroup_varsall>inventory/production/group_vars/all<a class=headerlink href=#inventoryproductiongroup_varsall title="Permanent link">&para;</a></h3> <p>Before applying the base configuration you will want to take a look at the projects group_vars:</p> <div class=codehilite><pre><span></span><code>nano inventory/production/group_vars/all
</code></pre></div> <p><code>group_vars/all</code> contains variables that will be used for all systems. Since the base configuration will be applied to all systems this is the perfect place to set variables for things that all systems have in common. For this project, that includes local users on each system for (manual) administration as well as a user for executing automated activities.</p> <h3 id=important>IMPORTANT<a class=headerlink href=#important title="Permanent link">&para;</a></h3> <p>You will probably want to change the <strong>state</strong> for the temporary user <em>julie</em> to be <strong>present</strong> before applying the base configuration. You want to do this because:</p> <ul> <li>You will be executing the base configuration as <em>julie</em> </li> </ul> <h3 id=ansible-command-run>ansible command run<a class=headerlink href=#ansible-command-run title="Permanent link">&para;</a></h3> <div class=codehilite><pre><span></span><code>./base-system-configuration.yml -l <span class=s2>&quot;workstation-003&quot;</span> -kK -e <span class=nv>ansible_user</span><span class=o>=</span>julie -e <span class=nv>ansible_python_interpreter</span><span class=o>=</span>/usr/bin/python3
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.0ac82a11.min.js></script> <script src=../../assets/javascripts/bundle.f81dfb4d.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../..",
          features: ['navigation.instant', 'navigation.tabs'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>